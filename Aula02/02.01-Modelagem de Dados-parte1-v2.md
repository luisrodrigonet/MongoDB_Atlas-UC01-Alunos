# Aula: Introdu√ß√£o √† Modelagem de Dados no MongoDB Atlas

> ## Objetivo da Aula
> 
> Esta aula tem como objetivo introduzir os conceitos b√°sicos de modelagem de dados em bancos NoSQL, especificamente no MongoDB. Ser√° abordada a diferen√ßa entre bancos relacionais e NoSQL, estrutura de documentos JSON, princ√≠pios de modelagem no MongoDB e, por fim, um exemplo pr√°tico de modelagem para um sistema de biblioteca.
> 
> ---
>

## :one:. Diferen√ßas entre Modelagem Relacional e NoSQL

### Banco de Dados Relacional (Exemplo: MySQL, PostgreSQL)

- **Estrutura R√≠gida:** Os dados s√£o organizados em **tabelas com colunas** bem definidas.
- **Normaliza√ß√£o:** O foco √© **evitar redund√¢ncia** dos dados, distribuindo informa√ß√µes em v√°rias **tabelas interligadas**.
- **Relacionamentos:** Utilizam **chaves prim√°rias e estrangeiras** para conectar tabelas.
- **√Ålgebra Relacional:** **Linguagem SQL** √© baseada nesse modelo.

**Exemplo:**
```sql
CREATE TABLE autores (
    id INT PRIMARY KEY,
    nome VARCHAR(100)
);

CREATE TABLE livros (
    id INT PRIMARY KEY,
    titulo VARCHAR(200),
    autor_id INT,
    FOREIGN KEY (autor_id) REFERENCES autores(id)
);
```

### Banco de Dados NoSQL - MongoDB

- **Flexibilidade:** Armazena dados em formato de **documentos (BSON/JSON)**, permitindo estruturas vari√°veis.
- **N√£o Normalizado:** √â comum denormalizar os dados para melhorar desempenho, **agrupando informa√ß√µes relacionadas em um √∫nico documento**.
- **Sem Esquema Fixo:** Cada documento **pode ter campos diferentes** dentro da mesma cole√ß√£o.
- **Escalabilidade Horizontal:** Projetado para **escalar horizontalmente** com mais facilidade.

> **OBS**: 
>
>Escalar horizontalmente (ou escala horizontal) significa adicionar mais servidores (n√≥s) ao sistema para lidar com mais carga, em vez de aumentar o poder de um √∫nico servidor.
>
> √â uma forma de distribuir o processamento e o armazenamento entre m√∫ltiplas m√°quinas , permitindo que o sistema suporte mais usu√°rios, mais requisi√ß√µes ou mais dados.
>
> ---
>

## :two: Estrutura de Documentos JSON: Campos, Arrays e Objetos Aninhados

MongoDB armazena dados em formato **BSON (Binary JSON)**. Um documento √© semelhante a um objeto JSON, composto por pares de chave-valor.

**O que √© JSON?**
- Formato textual usado para representar dados estruturados.
- F√°cil de ler e escrever.
- Usado principalmente em APIs e interfaces.


**Exemplo 01:**

```json
{
  "nome": "Jo√£o Silva",
  "idade": 35,
  "email": "joao@email.com"
}
```

**Exemplo 01:**

```json
{
  "nome": "Jo√£o",
  "idade": 30,
  "telefones": ["99999-1234", "98888-5678"],
  "endereco": {
    "rua": "Rua das Flores",
    "numero": 123
  }
}
```

**O que √© BSON?**
- Vers√£o bin√°ria do JSON.
- Usada internamente pelo MongoDB para armazenamento e indexa√ß√£o.
- Permite tipos especiais como `ObjectId`, `Date`, `Binary`, etc.

Exemplo interno (n√£o vis√≠vel diretamente):
```bson
{ "_id" : ObjectId("65e123abc123abc123abc123"), "name" : "Alice", "birth" : Date(946684800000) }
```

> üí° Voc√™ trabalha com JSON no dia a dia, mas o MongoDB converte automaticamente para BSON.

### Tipos de Estruturas de Dados Suportados no MongoDB

O **MongoDB** √© um banco de dados NoSQL orientado a documentos, e armazena os dados no formato **BSON (Binary JSON)**. Por isso, ele suporta uma grande variedade de estruturas de dados, mais flex√≠veis do que as encontradas em bancos relacionais.

#### üì¶ 1. **Campos Simples (Valores Primitivos)**

S√£o os tipos b√°sicos de dados, semelhantes aos encontrados em linguagens de programa√ß√£o.

**Exemplo:**

```json
{
  "nome": "Jo√£o",         // string
  "idade": 30,            // integer
  "altura": 1.75,         // double / float
  "ativo": true,          // boolean
  "observacao": null      // valor nulo
}
```

**Principais tipos primitivos:**

| Tipo | Descri√ß√£o |
|------|-----------|
| `string` | Texto (UTF-8) |
| `integer` | N√∫mero inteiro (32 ou 64 bits) |
| `double` | N√∫mero decimal (ponto flutuante) |
| `boolean` | `true` ou `false` |
| `null` | Representa aus√™ncia de valor |



#### üßÆ 2. **Arrays**

**Arrays** s√£o listas ordenadas de valores ou objetos. S√£o muito √∫teis para representar cole√ß√µes de dados relacionados.

**Exemplo com array simples:**

```json
{
  "nome": "Ana",
  "telefones": ["99999-1234", "98888-5678"]
}
```

**Exemplo com array de objetos:**

```json
{
  "nome": "Mariana",
  "notas": [
    { "disciplina": "Matem√°tica", "valor": 8.5 },
    { "disciplina": "Hist√≥ria", "valor": 9.0 }
  ]
}
```

> üí° Arrays s√£o ideais para campos como: tags, hist√≥rico, endere√ßos, filmes assistidos, etc.


#### üìÅ 3. **Objetos Aninhados (Embedded Documents)**

Objetos dentro de outros objetos. Servem para agrupar informa√ß√µes logicamente relacionadas em um mesmo documento.

**Exemplo:**

```json
{
  "nome": "Carlos",
  "endereco": {
    "rua": "Rua das Flores",
    "numero": 123,
    "cidade": "S√£o Paulo"
  }
}
```

> ‚ö†Ô∏è Objetos aninhados facilitam a leitura, mas devem ser usados com cuidado para n√£o deixar o documento muito complexo.

#### üîë 4. **Identificadores √önicos (_id)**

Todo documento no MongoDB tem um campo `_id`, que pode ser definido automaticamente ou manualmente.

**Exemplo autom√°tico (ObjectId):**

```json
{
  "_id": ObjectId("65e123abc123abc123abc123"),
  "nome": "Maria"
}
```

**Exemplo customizado:**

```json
{
  "_id": "usuario_123",
  "nome": "Pedro"
}
```

> ‚úÖ Recomenda-se usar `ObjectId` quando voc√™ quer IDs √∫nicos gerados automaticamente pelo MongoDB.


#### üóìÔ∏è 5. **Data e Hora (Date)**

O tipo `Date` armazena datas no formato Unix (milissegundos desde 1¬∫ de janeiro de 1970 UTC).

**Exemplo:**

```json
{
  "nome": "Relat√≥rio Mensal",
  "data_criacao": ISODate("2025-04-05T10:00:00Z")
}
```

> üí° Use `new Date()` no shell ou driver para inserir datas.

#### üßæ 6. **Tipos Especiais do BSON**

Al√©m dos tipos padr√£o do **JSON**, o **MongoDB** suporta v√°rios tipos especiais no formato **BSON**, que s√£o √∫teis para aplica√ß√µes espec√≠ficas.

**Alguns exemplos:**

| Tipo BSON | Descri√ß√£o | Uso Comum |
|----------|-----------|-----------|
| `ObjectId` | Identificador √∫nico de 12 bytes | Campo `_id` padr√£o |
| `Date` | Data e hora em milissegundos | Logs, auditoria |
| `Timestamp` | Valor usado internamente pelo MongoDB | Replica√ß√£o e oplog |
| `Regex` | Express√£o regular | Buscas avan√ßadas |
| `Binary` | Armazenamento de dados bin√°rios | Imagens, PDFs, arquivos |
| `MinKey` / `MaxKey` | Valores m√≠nimos e m√°ximos | Para compara√ß√£o interna |
| `Decimal128` | N√∫mero decimal com alta precis√£o | C√°lculos financeiros |

---

#### üìê 7. **Geolocaliza√ß√£o (GeoJSON)**

O MongoDB tamb√©m suporta tipos de dados **geoespaciais**, usando o formato **GeoJSON**.

**Exemplo:**

```json
{
  "nome": "Pra√ßa Central",
  "localizacao": {
    "type": "Point",
    "coordinates": [-46.6333, -23.5506] // [longitude, latitude]
  }
}
```

> üß≠ Muito √∫til para sistemas de mapas, localiza√ß√£o de usu√°rios ou pontos de interesse.

#### üìã 8. **Arrays de Refer√™ncias (Relacionamentos)**

Como o MongoDB n√£o tem jun√ß√µes, √†s vezes se **usa arrays de refer√™ncias para simular rela√ß√µes entre documentos**.

**Exemplo:**

```json
{
  "_id": ObjectId("..."),
  "titulo": "Dom Casmurro",
  "autor_id": ObjectId("...") // Refer√™ncia ao autor
}
```

> üí° Isso √© semelhante a chaves estrangeiras em bancos relacionais.

---

#### üéØ Resumindo

| Estrutura | O que √© | Quando usar |
|----------|---------|-------------|
| Campos Simples | Strings, n√∫meros, booleanos, null | Informa√ß√µes b√°sicas |
| Arrays | Listas de valores ou objetos | Tags, hist√≥ricos, m√∫ltiplos contatos |
| Objetos Aninhados | Documentos dentro de outros | Agrupar informa√ß√µes relacionadas |
| `_id` | Chave √∫nica do documento | Identifica√ß√£o de registros |
| `Date` | Data/hora | Registros com data de cria√ß√£o ou modifica√ß√£o |
| `ObjectId` | ID √∫nico gerado automaticamente | Identifica√ß√£o segura |
| GeoJSON | Dados geogr√°ficos | Localiza√ß√£o, mapas |
| Refer√™ncias (`author_id`) | IDs apontando para outros documentos | Relacionamentos entre cole√ß√µes |


## :three: Princ√≠pios de Modelagem de Dados no MongoDB

A modelagem de dados em bancos NoSQL como o **MongoDB** √© diferente daquela usada em bancos relacionais. Como o MongoDB √© orientado a documentos, ele permite uma maior flexibilidade e liberdade na forma como os dados s√£o estruturados.

No entanto, para garantir desempenho, escalabilidade e manuten√ß√£o eficiente, existem alguns **princ√≠pios-chave** que devem ser seguidos ao projetar suas cole√ß√µes e documentos.

### A) Proximidade dos Dados Mais Acessados Juntos

Se dois dados est√£o sempre usados juntos, devem estar no mesmo documento. Isso evita opera√ß√µes custosas de jun√ß√£o.

**üéØ Objetivo:**
Reduzir o n√∫mero de opera√ß√µes necess√°rias para recuperar informa√ß√µes frequentemente acessadas juntas.

**üí° Princ√≠pio:**
> Se dois ou mais dados s√£o sempre usados juntos, eles devem estar no mesmo documento.

**Exemplo:**

```json
{
  "nome": "Jo√£o Silva",
  "endereco": {
    "rua": "Rua das Flores",
    "numero": 123,
    "cidade": "S√£o Paulo"
  }
}
```

Em vez de separar `endere√ßos` em outra cole√ß√£o, inclu√≠mos dentro do pr√≥prio documento do usu√°rio, pois sempre que buscamos o usu√°rio, tamb√©m queremos seu endere√ßo.


### b) **Denormaliza√ß√£o** (Aceitar Redund√¢ncia)

Armazenar dados repetidos se isso melhorar o desempenho. Por exemplo, ao inv√©s de fazer uma consulta externa, inclu√≠mos as informa√ß√µes diretamente no documento.

**üéØ Objetivo:**
Evitar jun√ß√µes custosas e melhorar a performance de leitura.

**### üí° Princ√≠pio:**
> Em vez de normalizar ao m√°ximo como em bancos relacionais, podemos aceitar certa redund√¢ncia para facilitar consultas.

**Exemplo:**

Cole√ß√£o `filmes` com detalhes do diretor embutidos:

```json
{
  "titulo": "O Poderoso Chef√£o",
  "diretor": {
    "nome": "Francis Ford Coppola",
    "nacionalidade": "EUA"
  }
}
```

Mesmo que o diretor apare√ßa em v√°rios filmes, √© mais r√°pido ler tudo junto do que fazer m√∫ltiplas consultas ou usar `$lookup`.

### c) **Uso de Arrays para Listas Relacionadas**

Arrays s√£o ideais para representar listas de itens relacionados, como tags, telefones ou livros de um autor.

**üéØ Objetivo:**
Organizar listas de itens que possuem rela√ß√£o l√≥gica com o documento principal.

**üí° Princ√≠pio:**
> Use arrays para representar conjuntos de valores ou objetos relacionados diretamente ao documento.

**Exemplo:**

```json
{
  "nome": "Mariana",
  "cursos_matriculados": [
    { "nome": "Matem√°tica", "ano_inicio": 2024 },
    { "nome": "Hist√≥ria", "ano_inicio": 2024 }
  ]
}
```

Ao inv√©s de criar uma cole√ß√£o `matr√≠culas`, colocamos diretamente no documento do aluno, j√° que esses dados s√£o sempre acessados junto com o perfil do aluno.

### d) **Agrupamento L√≥gico com Objetos Aninhados**

Use objetos aninhados para organizar informa√ß√µes que fazem parte do mesmo contexto l√≥gico.

**üéØ Objetivo:**
Organizar informa√ß√µes logicamente relacionadas dentro do mesmo documento.

**üí° Princ√≠pio:**
> Agrupe campos que fazem parte de um mesmo contexto usando objetos aninhados.

**Exemplo:**

```json
{
  "nome": "Carlos Almeida",
  "contato": {
    "email": "carlos@email.com",
    "telefones": ["99999-1234", "98888-5678"]
  }
}
```

Isso mant√©m o documento organizado e leg√≠vel, al√©m de facilitar buscas espec√≠ficas como por email ou telefone.

### e) **Escolha entre Embedding ou Refer√™ncia**

- **Embedding:** Incluir dados relacionados dentro do mesmo documento (ideal para leitura r√°pida).
- **Refer√™ncia:** Armazenar apenas IDs de outros documentos (similar a chaves estrangeiras).

**üéØ Objetivo:**
Decidir quando armazenar dados dentro do documento (embedding) ou referenciar outros documentos.

**üí° Princ√≠pio:**
> Use **embedding** para dados est√°ticos e frequentemente lidos.  
> Use **refer√™ncias** para dados din√¢micos ou compartilhados entre muitos documentos.

**Comparando:**

**‚úÖ Embedding ‚Äì Bom para leitura r√°pida:**

```json
{
  "titulo": "Dom Casmurro",
  "autor": {
    "nome": "Machado de Assis",
    "nacionalidade": "Brasil"
  }
}
```

**üîó Refer√™ncia ‚Äì Bom para atualiza√ß√µes frequentes:**

```json
{
  "titulo": "Dom Casmurro",
  "autor_id": ObjectId("65e123abc123abc123abc123")
}
```

> Se o autor muda frequentemente, √© melhor ter uma cole√ß√£o `autores` √† parte e referenci√°-la.

---

### **f) Projeto Baseado no Padr√£o de Acesso**

**üéØ Objetivo:**
Modelar os dados conforme o padr√£o de uso da aplica√ß√£o.

**üí° Princ√≠pio:**
> Modele seus dados baseado nas **queries mais comuns**, n√£o apenas na estrutura do problema.

**Exemplo:**

Se sua aplica√ß√£o precisa mostrar todos os coment√°rios de um filme junto com o nome do filme:

```json
{
  "_id": ObjectId("..."),
  "filme": "Titanic",
  "usuario": "Ana Clara",
  "comentario": "Filme emocionante!",
  "data": ISODate("2025-04-05T12:00:00Z")
}
```

Dessa forma, voc√™ evita joins e ganha velocidade.

### **g) Evite Jun√ß√µes (ou use $lookup com cuidado)**

**üéØ Objetivo:**
Manter alta performance em grandes volumes de dados.

**üí° Princ√≠pio:**
> O MongoDB n√£o tem jun√ß√µes como em SQL. Use `$lookup` somente se necess√°rio, e prefira embedding.

**Exemplo com `$lookup` (JOIN entre duas cole√ß√µes):**

```javascript
db.filmes.aggregate([
  {
    $match: { titulo: "Interestelar" }
  },
  {
    $lookup: {
      from: "comentarios",
      localField: "_id",
      foreignField: "filme_id",
      as: "comentarios"
    }
  }
]);
```

> Isso pode ser √∫til, mas tem custo de processamento. Use com modera√ß√£o.

---

### **h) Escalabilidade Horizontal desde o Projeto**

**üéØ Objetivo:**
Projetar modelos que permitam escalar horizontalmente.

**üí° Princ√≠pio:**
> Estruture os dados pensando em **sharding** ‚Äî distribui√ß√£o de dados entre servidores.

**Exemplo:**

Se tiver milh√µes de usu√°rios, divida-os por regi√£o:

```json
{
  "nome": "Roberto",
  "regiao": "SP",
  "ultima_compra": ISODate("2025-04-01T10:00:00Z")
}
```

Use `regiao` como chave de shard para distribuir os dados entre servidores.

---

### ‚úÖ Resumindo

| Princ√≠pio | Descri√ß√£o |
|----------|-----------|
| **Proximidade dos Dados** | Coloque juntos o que √© usado junto |
| **Denormaliza√ß√£o** | Aceite redund√¢ncia para evitar joins |
| **Arrays** | Use para listas de valores ou objetos relacionados |
| **Objetos Aninhados** | Agrupe campos com contexto comum |
| **Embedding vs Refer√™ncia** | Use embedding para dados est√°ticos e refer√™ncias para dados din√¢micos |
| **Projeto pelo Padr√£o de Acesso** | Modele os dados conforme o uso da aplica√ß√£o |
| **Evite Jun√ß√µes** | Prefira embedding ao inv√©s de `$lookup` |
| **Escalabilidade Horizontal** | Estruture os dados considerando sharding |

